

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>12. Dynamic Command Configuration &mdash; Cog Book 1.0.0 documentation</title>
  


    <link rel="shortcut icon" href="../_static/favicon.ico"/>


  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Cog Book 1.0.0 documentation" href="../index.html"/>
        <link rel="next" title="13. Returning data from Cog" href="returning_data_from_cog.html"/>
        <link rel="prev" title="11. Command Environment Variables" href="command_environment_variables.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Cog Book
          

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
          </a>

          
            <img src="../_static/cog_peek.svg" class="logo" />
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">1. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootstrapping_cog.html">2. Bootstrapping Cog</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing_and_managing_relays.html">3. Installing and Managing Relays</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands_and_bundles.html">4. Commands and Bundles</a></li>
<li class="toctree-l1"><a class="reference internal" href="managing_bundles.html">5. Managing Bundles</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_a_command_bundle.html">6. Writing A Command Bundle</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring_password_resets.html">7. Configuring password resets</a></li>
<li class="toctree-l1"><a class="reference internal" href="permissions_and_rules.html">8. Permissions and Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_execution_rules.html">9. Command Execution Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="bundle_configs.html">10. Bundle Configs</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_environment_variables.html">11. Command Environment Variables</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">12. Dynamic Command Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#core-concepts">12.1. Core Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#layers">12.1.1. Layers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-manage-dynamic-configuration-values">12.2. How To Manage Dynamic Configuration Values</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#manual-management-of-dynamic-configuration">12.2.1. Manual Management of Dynamic Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cog-managed-dynamic-configuration">12.2.2. Cog-managed Dynamic Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-base-layer-of-dynamic-configuration">12.2.2.1. Adding a base layer of dynamic configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#showing-the-layers-that-exist">12.2.2.2. Showing the layers that exist</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deleting-configuration-layers">12.2.2.3. Deleting Configuration Layers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="returning_data_from_cog.html">13. Returning data from Cog</a></li>
<li class="toctree-l1"><a class="reference internal" href="services.html">14. Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">15. Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing_your_first_command_bundle.html">16. Installing Your First Command Bundle</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing_a_trigger.html">17. Developing a Trigger</a></li>
<li class="toctree-l1"><a class="reference internal" href="cog_architecture.html">18. Cog Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_pipelines.html">19. Command pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="redirecting_pipeline_output.html">20. Redirecting Pipeline Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="triggers.html">21. Triggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_management.html">22. User management</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor_license_agreement.html">23. Contributor License Agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/cog_server_configuration.html">24. Cog Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/relay_configuration.html">25. Relay Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/command_output_tags.html">26. Command Output Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/greenbar_tags.html">27. Greenbar Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/audit_log_events.html">28. Audit Log Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/glossary.html">29. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/designing_for_chatops.html">30. Designing ChatOps Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/chat_platforms.html">31. Notes on Chat Platform Support</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Cog Book</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          









<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>12. Dynamic Command Configuration</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/operable/cog-book/blob/master/cog-book/source/sections/dynamic_command_configuration.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dynamic-command-configuration">
<h1>12. Dynamic Command Configuration<a class="headerlink" href="#dynamic-command-configuration" title="Permalink to this headline">¶</a></h1>
<p>Often, commands will need tokens, passwords, or other sensitive
information at runtime in order to do their job; managing your
<a class="reference external" href="https://github.com/cogcmd/mist">AWS</a> servers, sending a
<a class="reference external" href="https://github.com/cogcmd/twitter">tweet</a>, checking your <a class="reference external" href="https://github.com/cogcmd/pingdom">site
availability</a>, and many other
tasks would be impossible otherwise (at least, not without resorting to
horrible software engineering practices in your command bundles!). Cog
provides a way to deal with these important data called <em>dynamic command
configuration</em>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When we talk about &#8220;dynamic command configuration&#8221;, this should
not be confused with the <a class="reference internal" href="bundle_configs.html"><span class="doc">config.yaml</span></a> file
that defines the commands, rules, and permissions present in each
command bundle. That configuration is effectively static. The
configuration we are concerned with is for the <em>execution</em> of
individual commands.</p>
<p class="last">It’s also dynamic in the sense that it can be changed on-the-fly
by Cog administrators, with the changes taking effect nearly
instantaneously without restarting any applications.</p>
</div>
<div class="section" id="core-concepts">
<h2>12.1. Core Concepts<a class="headerlink" href="#core-concepts" title="Permalink to this headline">¶</a></h2>
<p>As detailed below, there are a few ways to go about specifying and
managing the dynamic configuration for a bundle, but the central idea is
straightforward. At the core, a dynamic configuration is a series of
key-value pairs which are injected as variables into the execution
environment of a command.</p>
<p>As a concrete example, let’s look at Cog’s <a class="reference external" href="https://github.com/cogcmd/pingdom">Pingdom
bundle</a>. As we can
<a class="reference external" href="https://github.com/cogcmd/pingdom/blob/ce0e124bd5dd75e2f50b1e9ca94a153d9ac87c13/config.yaml#L26-L32">see</a>,
the <code class="docutils literal"><span class="pre">pingdom:check</span></code> command expects three environment variables to be
set: <code class="docutils literal"><span class="pre">PINGDOM_USER_EMAIL</span></code>, <code class="docutils literal"><span class="pre">PINGDOM_USER_PASSWORD</span></code>, and
<code class="docutils literal"><span class="pre">PINGDOM_APPLICATION_KEY</span></code>. Each of these credentials are required
before we can make a properly authenticated REST API request against
Pingdom’s servers.</p>
<p>We can store these credentials in a simple YAML file and make it
available to Relay (we’ll talk about exactly how to do that below, but
the details aren’t important right now).</p>
<p><strong>Pingdom Dynamic Configuration.</strong></p>
<div class="code YAML highlight-default"><div class="highlight"><pre><span></span><span class="n">PINGDOM_USER_EMAIL</span><span class="p">:</span> <span class="n">me</span><span class="nd">@mycompany</span><span class="o">.</span><span class="n">com</span>
<span class="n">PINGDOM_USER_PASSWORD</span><span class="p">:</span> <span class="n">supersecret</span>
<span class="n">PINGDOM_APPLICATION_KEY</span><span class="p">:</span> <span class="n">abcdefghijklmnopqrstuvwxyz</span>
</pre></div>
</div>
<p>Relay will inject these values into the execution environment it builds
for each command in the <code class="docutils literal"><span class="pre">pingdom</span></code> bundle. Commands can then access
them as environment variables (e.g. <code class="docutils literal"><span class="pre">ENV['PINGDOM_USER_EMAIL']</span></code> in
Ruby, <code class="docutils literal"><span class="pre">os.environ['PINGDOM_USER_EMAIL']</span></code> in Python, etc.)</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Each command in a bundle will receive the same dynamic configuration
environment. There is not currently a way to cause one command to
receive one set of variables while another receives a different set.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Any keys starting with the prefixes <code class="docutils literal"><span class="pre">COG_</span></code> or <code class="docutils literal"><span class="pre">RELAY_</span></code> will be
logged by Relay and ignored.</p>
</div>
<div class="section" id="layers">
<h3>12.1.1. Layers<a class="headerlink" href="#layers" title="Permalink to this headline">¶</a></h3>
<p>Cog allows you to refine the values of these dynamic configurations
based on the room the command is invoked from, the user that invokes the
command, or a combination of both. For example, this would allow you to
configure the <a class="reference external" href="https://github.com/cogcmd/twitter">twitter</a> bundle to
tweet from a special support account when invoked from your <code class="docutils literal"><span class="pre">#support</span></code>
Slack channel, but from your main company account when called from your
<code class="docutils literal"><span class="pre">#marketing</span></code> channel.</p>
<p>All bundles can have a &#8220;base&#8221; configuration layer, which defines (in the
absence of any additional layering) the key-value pairs that will be
used for command invocations in general. The YAML file above could
define the base layer for the <code class="docutils literal"><span class="pre">pingdom</span></code> bundle. If you don’t require
any room- or user-specific customizations, this is the only layer you
really need to care about; in fact, you can act as though layers don’t
even exist.</p>
<p>On top of this base, a &#8220;room&#8221; layer can be overlaid using a merge
strategy. Any keys in common will take their values from the room layer,
while any keys only mentioned in the base will take their values from
that layer. While there is only one &#8220;base&#8221; layer, each bundle can have
any number of room layers, named for a room in their chat client. In our
Twitter example above, we would have a &#8220;room/support&#8221; layer, and a
&#8220;room/marketing&#8221; layer. Whenever a <code class="docutils literal"><span class="pre">twitter</span></code> bundle command was
invoked from one of those rooms, the appropriate layer would be put into
play.</p>
<p>Finally, the same situation applies for &#8220;user&#8221; layers. If Alice should
only ever tweet from a particular account, the appropriate credentials
could be put into a &#8220;user/alice&#8221; layer (assuming her Cog username is
&#8220;alice&#8221;).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since different chat clients can have different conventions, Cog
normalizes names by lowercasing them. Thus, the room layer for your
\&#8221;Operations\&#8221; room would be \&#8221;room/operations\&#8221;.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Early in processing a request, Cog resolves a user’s chat handle to
that person’s Cog username, and this is what is used to determine
the appropriate user configuration layer to apply.</p>
</div>
<p>Let’s look at a basic example of how this would work in practice. Let’s
say we have a <code class="docutils literal"><span class="pre">widget:widget</span></code> command that we want to configure. For
it’s base configuration we’ll use this:</p>
<p><strong>base.</strong></p>
<div class="code YAML highlight-default"><div class="highlight"><pre><span></span><span class="n">WIDGET_FOO</span><span class="p">:</span> <span class="n">base</span>
<span class="n">WIDGET_BAR</span><span class="p">:</span> <span class="n">base</span>
<span class="n">WIDGET_BAZ</span><span class="p">:</span> <span class="n">base</span>
</pre></div>
</div>
<p>(I leave it to your imagination what exciting things a <code class="docutils literal"><span class="pre">widget</span></code>
command could do with such configuration values.)</p>
<p>If this command is invoked from our <code class="docutils literal"><span class="pre">#ops</span></code> Slack channel, we’ll
override a few values:</p>
<p><strong>room/ops.</strong></p>
<div class="code YAML highlight-default"><div class="highlight"><pre><span></span><span class="n">WIDGET_BAR</span><span class="p">:</span> <span class="n">ops</span>
<span class="n">WIDGET_BAZ</span><span class="p">:</span> <span class="n">ops</span>
</pre></div>
</div>
<p>Finally, if Alice invokes the command, we’ll add one more refinement:</p>
<p><strong>user/alice.</strong></p>
<div class="code YAML highlight-default"><div class="highlight"><pre><span></span><span class="n">WIDGET_BAZ</span><span class="p">:</span> <span class="n">alice</span>
</pre></div>
</div>
<p>Now, if Bob runs this command from the <code class="docutils literal"><span class="pre">#engineering</span></code> channel, that
invocation will receive just the base configuration values, because we
have defined neither a <code class="docutils literal"><span class="pre">room/engineering</span></code> layer, nor a <code class="docutils literal"><span class="pre">user/bob</span></code>
layer.</p>
<p>If Bob runs this command from the <code class="docutils literal"><span class="pre">#ops</span></code> channel, however, this is
what the command will receive in its environment:</p>
<p><strong>base + room/ops.</strong></p>
<div class="code YAML highlight-default"><div class="highlight"><pre><span></span><span class="n">WIDGET_FOO</span><span class="p">:</span> <span class="n">base</span>
<span class="n">WIDGET_BAR</span><span class="p">:</span> <span class="n">ops</span>
<span class="n">WIDGET_BAZ</span><span class="p">:</span> <span class="n">ops</span>
</pre></div>
</div>
<p>As you can see, <code class="docutils literal"><span class="pre">WIDGET_BAR</span></code> and <code class="docutils literal"><span class="pre">WIDGET_BAZ</span></code> have been overridden,
but <code class="docutils literal"><span class="pre">WIDGET_FOO</span></code> takes it’s value from the base configuration. Had we
added a value for <code class="docutils literal"><span class="pre">WIDGET_FOO</span></code> to our <code class="docutils literal"><span class="pre">room/ops</span></code> layer, though, that
value would have been used here.</p>
<p>Now, when Alice runs this command from <code class="docutils literal"><span class="pre">#engineering</span></code>, her invocation
will receive this set of values:</p>
<p><strong>base + user/alice.</strong></p>
<div class="code YAML highlight-default"><div class="highlight"><pre><span></span><span class="n">WIDGET_FOO</span><span class="p">:</span> <span class="n">base</span>
<span class="n">WIDGET_BAR</span><span class="p">:</span> <span class="n">base</span>
<span class="n">WIDGET_BAZ</span><span class="p">:</span> <span class="n">alice</span>
</pre></div>
</div>
<p>There is no <code class="docutils literal"><span class="pre">room/engineering</span></code> layer in place, so we still have the
<code class="docutils literal"><span class="pre">WIDGET_BAR</span></code> value from our base layer, but the <code class="docutils literal"><span class="pre">user/alice</span></code> layer
has been overlaid.</p>
<p>If Alice runs the command from <code class="docutils literal"><span class="pre">#ops</span></code>, all three layers will be in
effect:</p>
<p><strong>base = room/ops + alice.</strong></p>
<div class="code YAML highlight-default"><div class="highlight"><pre><span></span><span class="n">WIDGET_FOO</span><span class="p">:</span> <span class="n">base</span>
<span class="n">WIDGET_BAR</span><span class="p">:</span> <span class="n">ops</span>
<span class="n">WIDGET_BAZ</span><span class="p">:</span> <span class="n">alice</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-manage-dynamic-configuration-values">
<h2>12.2. How To Manage Dynamic Configuration Values<a class="headerlink" href="#how-to-manage-dynamic-configuration-values" title="Permalink to this headline">¶</a></h2>
<p>There are currently two ways to manage dynamic configuration values. The
default method involves placing dynamic configuration YAML files on the
Relay host (either manually, or via the automation tooling of your
choice). The alternative allows Cog to centrally manage the
configurations on your behalf.</p>
<div class="section" id="manual-management-of-dynamic-configuration">
<h3>12.2.1. Manual Management of Dynamic Configuration<a class="headerlink" href="#manual-management-of-dynamic-configuration" title="Permalink to this headline">¶</a></h3>
<p>Under manual management, a Relay will look in a directory tree to find
YAML files containing layered dynamic configuration values. The layers
will be merged as described above (<code class="docutils literal"><span class="pre">base</span></code>, then <code class="docutils literal"><span class="pre">room</span></code>, then
<code class="docutils literal"><span class="pre">user</span></code>) and injected into the execution environment. As the files are
consulted on each command invocation (rather than cached), any changes
to the files will take effect on the next invocation of a command. This
is a tiny bit slower compared to caching the contents but ensures
commands are always run with the latest configuration.</p>
<p>To enable this mode, Relay must be told where your configuration files
will reside by setting the <a class="reference internal" href="../references/relay_configuration.html#relay-dynamic-config-root"><span class="std std-ref">RELAY_DYNAMIC_CONFIG_ROOT</span></a>
configuration. If you are changing this value, you will need to restart
Relay for it to take effect.</p>
<p>Within the <code class="docutils literal"><span class="pre">RELAY_DYNAMIC_CONFIG_ROOT</span></code> directory, there should be a
directory for each bundle that needs dynamic configuration. Each of
these bundle directories will contain one or more YAML files (with
either a <code class="docutils literal"><span class="pre">*.yaml</span></code> or <code class="docutils literal"><span class="pre">*.yml</span></code> extension), with each file
corresponding to an individual layer. The naming conventions are as
follows:</p>
<ul class="simple">
<li>base configuration layer: <code class="docutils literal"><span class="pre">config.yaml</span></code>, always.</li>
<li>room layers: <code class="docutils literal"><span class="pre">room_${LOWERCASE_ROOM_NAME}.yaml</span></code>. If desired, 1-on-1
interactions with Cog can be configured with a <code class="docutils literal"><span class="pre">room_direct.yaml</span></code>
file.</li>
<li>user layers: <code class="docutils literal"><span class="pre">user_${LOWERCASE_COG_USERNAME}.yaml</span></code></li>
</ul>
<p>In the example directory tree below (which assumes a
<code class="docutils literal"><span class="pre">RELAY_DYNAMIC_CONFIG_ROOT</span></code> of <code class="docutils literal"><span class="pre">/relay-config</span></code>), we have the
<a class="reference external" href="https://github.com/cogcmd/heroku">heroku</a> bundle with a single base
configuration, the <a class="reference external" href="https://github.com/cogcmd/pingdom">pingdom</a>
bundle with a base layer, an &#8220;ops&#8221; room layer, a 1-on-1 direct chat room
layer, and a user layer for &#8220;chris&#8221;. Finally, the
<a class="reference external" href="https://github.com/cogcmd/twitter">twitter</a> bundle has a single base
configuration layer.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>|relay-config
├── heroku
│   └── config.yaml
├── pingdom
│   ├──config.yaml
│   ├── room_ops.yaml
│   ├── room\_direct.yaml
│   └──user\_chris.yaml
└── twitter └── config.yaml
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><em>About Relays</em></p>
<ul class="last simple">
<li><a class="reference internal" href="installing_and_managing_relays.html"><span class="doc">Installing and Managing Relays</span></a></li>
<li><a class="reference external" href="https://github.com/operable/go-relay/blob/master/example_relay.conf">Annotated relay.conf</a></li>
</ul>
</div>
</div>
<div class="section" id="cog-managed-dynamic-configuration">
<h3>12.2.2. Cog-managed Dynamic Configuration<a class="headerlink" href="#cog-managed-dynamic-configuration" title="Permalink to this headline">¶</a></h3>
<p>While manually-managed dynamic configuration is simple, it can be
cumbersome if you run multiple Relays, or do not have filesystem access
to your Relay (as is the case with <a class="reference external" href="https://cog.operable.io">Hosted
Cog</a>). In this case, you can submit your
dynamic configuration layer files to Cog and it will distribute the
values to your Relays as appropriate.</p>
<p>By default your Relay(s) already supports managed dynamic config, but
you can always disable it by setting &lt;RELAY_MANAGED_DYNAMIC_CONFIG&gt;&gt;
to <code class="docutils literal"><span class="pre">false</span></code>. Managed Relays check in with their Cog server periodically
(every 5 seconds by default; see
<a class="reference internal" href="../references/relay_configuration.html#relay-managed-dynamic-config-interval"><span class="std std-ref">RELAY_MANAGED_DYNAMIC_CONFIG_INTERVAL</span></a> ) to refresh their
configuration data.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently, managed configuration mode requires each individual Relay
to be configured as such; it is not a centrally-enabled option.
Future versions of Cog and Relay may change this.</p>
</div>
<p>The easiest way submit configuration layers to Cog is by using
<code class="docutils literal"><span class="pre">cogctl</span></code>, which in turn uses Cog’s REST API.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">These commands and the API they are built on <em>only</em> work for the
Cog-managed configuration. They will not have access to
manually-managed configuration files on Relay hosts. The manual
process is, well, <em>manual</em>.</p>
</div>
<div class="section" id="adding-a-base-layer-of-dynamic-configuration">
<h4>12.2.2.1. Adding a base layer of dynamic configuration<a class="headerlink" href="#adding-a-base-layer-of-dynamic-configuration" title="Permalink to this headline">¶</a></h4>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ cogctl bundle config create pingdom ~/path/to/config.yaml --layer=base
Created base layer for &#39;pingdom&#39; bundle
</pre></div>
</div>
<p>Here, the <code class="docutils literal"><span class="pre">--layer</span></code> option is not required; if not specified, &#8220;base&#8221;
is always the default.</p>
<p>Adding other layers is similar:</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ cogctl bundle config create pingdom ~/path/to/room_ops.yaml --layer=room/ops
Created room/ops layer for &#39;pingdom&#39; bundle
$ cogctl dynamic-config create pingdom ~/path/to/user_chris.yaml --layer=user/chris
Created user/chris layer for &#39;pingdom&#39; bundle
</pre></div>
</div>
</div>
<div class="section" id="showing-the-layers-that-exist">
<h4>12.2.2.2. Showing the layers that exist<a class="headerlink" href="#showing-the-layers-that-exist" title="Permalink to this headline">¶</a></h4>
<p>You can list all layers that are currently in place for a given bundle.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ cogctl bundle config layers pingdom
base
room/ops
user/chris
</pre></div>
</div>
<p>For any given layer, you can see the configuration that will be used.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ cogctl bundle config info pingdom base
PINGDOM_USER_PASSWORD: &quot;secret_dont_tell&quot;
PINGDOM_USER_EMAIL: &quot;cog@operable.io&quot;
PINGDOM_APPLICATION_KEY: &quot;blahblahblah&quot;
</pre></div>
</div>
<p>Again, if you do not specify a layer, &#8220;base&#8221; is assumed. That is,
<code class="docutils literal"><span class="pre">cogctl</span> <span class="pre">bundle</span> <span class="pre">config</span> <span class="pre">info</span> <span class="pre">pingdom</span></code> is equivalent to the above command.</p>
<p>You can also see other layers:</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ cogctl bundle config info pingdom room/ops
PINGDOM_USER_PASSWORD: &quot;ops4life&quot;
PINGDOM_USER_EMAIL: &quot;cog_ops@operable.io&quot;
PINGDOM_APPLICATION_KEY: &quot;opsblahblahblah&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<div class="last line-block">
<div class="line">The <code class="docutils literal"><span class="pre">cogctl</span> <span class="pre">bundle</span> <span class="pre">config</span> <span class="pre">info</span></code> subcommand returns the contents
of <em>only</em> the specified layer; it does not show you the effective
configuration that might be injected into a command’s execution
environment. You are shown exactly what was uploaded when you ran</div>
<div class="line"><br /></div>
<div class="line">cogctl bundle config create $BUNDLE $PATH_TO_CONFIGURATION_FILE &#8211;layer=$LAYER</div>
<div class="line"><br /></div>
<div class="line">not the result of overlaying multiple layers on top of each other.</div>
</div>
</div>
</div>
<div class="section" id="deleting-configuration-layers">
<h4>12.2.2.3. Deleting Configuration Layers<a class="headerlink" href="#deleting-configuration-layers" title="Permalink to this headline">¶</a></h4>
<p>Configuration layers can be deleted individually</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>$ cogctl bundle config delete pingdom
Deleted &#39;base&#39; layer for bundle &#39;pingdom&#39;
$ cogctl bundle config delete pingdom room/ops
Deleted &#39;room/ops&#39; layer for bundle &#39;pingdom&#39;
</pre></div>
</div>
<p>(As before, not specifying a layer defaults to operating on the <code class="docutils literal"><span class="pre">base</span></code>
layer.)</p>
<p>Note that by deleting the &#8220;base&#8221; layer only deletes the base layer; any
room or user layers will still be applied. If you wish to remove <em>all</em>
dynamic configuration, you must remove each layer individually. The
following pipelines may be useful:</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Remove ALL layers</span>
<span class="n">cogctl</span> <span class="n">bundle</span> <span class="n">config</span> <span class="n">layers</span> <span class="n">pingdom</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">n1</span> <span class="n">cogctl</span> <span class="n">bundle</span> <span class="n">config</span> <span class="n">delete</span> <span class="n">pingdom</span>

<span class="c1"># Remove only room layers</span>
<span class="n">cogctl</span> <span class="n">bundle</span> <span class="n">config</span> <span class="n">layers</span> <span class="n">pingdom</span> <span class="o">|</span> <span class="n">grep</span> <span class="s2">&quot;room/&quot;</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">n1</span> <span class="n">cogctl</span> <span class="n">bundle</span> <span class="n">config</span> <span class="n">delete</span> <span class="n">pingdom</span>

<span class="c1"># Remove only user layers</span>
<span class="n">cogctl</span> <span class="n">bundle</span> <span class="n">config</span> <span class="n">layers</span> <span class="n">pingdom</span> <span class="o">|</span> <span class="n">grep</span> <span class="s2">&quot;user/&quot;</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">-</span><span class="n">n1</span> <span class="n">cogctl</span> <span class="n">bundle</span> <span class="n">config</span> <span class="n">delete</span> <span class="n">pingdom</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="returning_data_from_cog.html" class="btn btn-neutral float-right" title="13. Returning data from Cog" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="command_environment_variables.html" class="btn btn-neutral" title="11. Command Environment Variables" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 Operable, Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61670076-4', 'auto');
  ga('send', 'pageview');

  </script>
  


</body>
</html>